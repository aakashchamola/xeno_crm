(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{1249:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(4232),n=a(9099),i=a(6984);function s(e){let{children:t}=e,a=(0,n.useRouter)();return(0,l.useEffect)(()=>{!function(){let e=localStorage.getItem("jwt");if(!e)return null;try{let t=(0,i.s)(e);if(t.exp&&Date.now()/1e3>t.exp)return localStorage.removeItem("jwt"),localStorage.removeItem("user"),null;return t}catch(e){return null}}()&&(localStorage.removeItem("jwt"),localStorage.removeItem("user"),a.replace("/"))},[a]),t}},7172:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var l=a(7876),n=a(4232),i=a(9569);a(3015);let s=[{name:"spend",label:"Spend",inputType:"number"},{name:"visits",label:"Visits",inputType:"number"},{name:"last_purchase_date",label:"Last Purchase Date",inputType:"date"},{name:"inactive_days",label:"Inactive Days",inputType:"number"}];function r(e){let{rules:t,setRules:a}=e,n=t&&"object"==typeof t?t:{combinator:"and",rules:[]};return(0,l.jsxs)("section",{"aria-label":"Segment Rule Builder",children:[(0,l.jsx)("h4",{tabIndex:0,children:"Segment Rules"}),(0,l.jsx)(i.oS,{fields:s,query:n,onQueryChange:e=>a(e),"aria-label":"Visual Rule Builder"}),(0,l.jsx)("pre",{"aria-live":"polite",children:JSON.stringify(n,null,2)})]})}var o=a(1040);function u(e){let{onCreated:t}=e,[a,i]=(0,n.useState)(""),[s,u]=(0,n.useState)(""),[c,g]=(0,n.useState)({combinator:"and",rules:[]}),[d,m]=(0,n.useState)(""),[p,h]=(0,n.useState)(!1),[b,S]=(0,n.useState)(""),[j,x]=(0,n.useState)(""),[y,v]=(0,n.useState)(null),C="http://localhost:3002",f="http://localhost:5002",[w,k]=(0,n.useState)([]),[A,_]=(0,n.useState)(""),[I,R]=(0,n.useState)([]),[T,N]=(0,n.useState)([]),F=async()=>{h(!0),S(""),x("");try{let e=localStorage.getItem("jwt"),t=await o.A.post("".concat(C,"/campaigns/preview"),{segmentRules:c},{headers:{Authorization:"Bearer ".concat(e)}});v(t.data.count)}catch(e){S("Failed to preview segment")}h(!1)},D=async()=>{h(!0),S("");try{let e=await o.A.post("".concat(f,"/ai/lookalike"),{segmentRules:c});R(e.data.lookalike||[])}catch(e){S("Failed to get lookalike segment")}h(!1)},E=async()=>{h(!0),S("");try{let e=await o.A.post("".concat(f,"/ai/auto-tag"),{campaignName:a,message:s});N(e.data.tags||[])}catch(e){S("Failed to get tags")}h(!1)},q=async()=>{h(!0),S("");try{let e=await o.A.post("".concat(f,"/ai/suggest-send-time"),{segmentRules:c});_(e.data.suggestedTime)}catch(e){S("Failed to get suggested time")}h(!1)},z=async()=>{h(!0),S("");try{let e=await o.A.post("".concat(f,"/ai/suggest-message"),{segmentRules:c,campaignName:a});k(e.data.suggestions||[])}catch(e){S("Failed to get message suggestions")}h(!1)},B=async()=>{h(!0),S(""),x("");try{let e=await o.A.post("".concat(f,"/ai/parse-rules"),{prompt:d});g(e.data.rules||[])}catch(e){S("AI service error")}h(!1)},L=async e=>{e.preventDefault(),h(!0),S(""),x("");try{let e=localStorage.getItem("jwt");await o.A.post("".concat(C,"/campaigns"),{name:a,message:s,segmentRules:c},{headers:{Authorization:"Bearer ".concat(e)}}),x("Campaign created!"),t&&t()}catch(e){S("Failed to create campaign")}h(!1)};return(0,l.jsxs)("form",{onSubmit:L,"aria-label":"Create Campaign Form",children:[(0,l.jsx)("h2",{tabIndex:0,children:"Create Campaign"}),b&&(0,l.jsx)("div",{role:"alert",children:b}),j&&(0,l.jsx)("div",{role:"status",children:j}),(0,l.jsx)("label",{htmlFor:"campaign-name",children:"Campaign Name:"}),(0,l.jsx)("input",{id:"campaign-name",value:a,onChange:e=>i(e.target.value),required:!0,"aria-required":"true","aria-label":"Campaign Name",autoComplete:"off"}),(0,l.jsx)("br",{}),(0,l.jsx)("label",{htmlFor:"campaign-message",children:"Message:"}),(0,l.jsx)("input",{id:"campaign-message",value:s,onChange:e=>u(e.target.value),required:!0,"aria-required":"true","aria-label":"Message",autoComplete:"off"}),(0,l.jsx)("br",{}),(0,l.jsx)("label",{htmlFor:"ai-prompt",children:"Describe your segment (AI):"}),(0,l.jsx)("input",{id:"ai-prompt",value:d,onChange:e=>m(e.target.value),"aria-label":"AI Segment Description",autoComplete:"off"}),(0,l.jsx)("button",{type:"button",onClick:B,disabled:p,style:{marginLeft:8},"aria-label":"Suggest Rules",children:p?"Generating...":"Suggest Rules"}),(0,l.jsx)("br",{}),(0,l.jsx)("button",{type:"button",onClick:F,disabled:p||!c.length,style:{marginBottom:8},"aria-label":"Preview Segment Size",children:"Preview Segment Size"}),null!==y&&(0,l.jsxs)("span",{style:{marginLeft:8},children:["Audience Size: ",y]}),(0,l.jsx)("button",{type:"button",onClick:D,disabled:p,"aria-label":"Suggest Lookalike Segment",children:"Suggest Lookalike Segment"}),I.length>0&&(0,l.jsx)("pre",{"aria-live":"polite",children:JSON.stringify(I,null,2)}),(0,l.jsx)("button",{type:"button",onClick:E,disabled:p,"aria-label":"Auto-tag Campaign",children:"Auto-tag Campaign"}),T.length>0&&(0,l.jsxs)("div",{"aria-live":"polite",children:["Tags: ",T.join(", ")]}),(0,l.jsx)("button",{type:"button",onClick:z,disabled:p,"aria-label":"Suggest Messages",children:"Suggest Messages"}),w.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{children:"Suggestions:"}),(0,l.jsx)("ul",{children:w.map((e,t)=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{type:"button",onClick:()=>u(e),"aria-label":"Use suggestion: ".concat(e),children:e})},t))})]}),(0,l.jsx)("button",{type:"button",onClick:q,disabled:p,"aria-label":"Suggest Send Time",children:"Suggest Send Time"}),A&&(0,l.jsxs)("div",{"aria-live":"polite",children:["Suggested Send Time: ",A]}),(0,l.jsx)(r,{rules:c,setRules:g}),(0,l.jsx)("button",{type:"submit",disabled:p,style:{marginTop:12},"aria-label":"Create Campaign",children:p?"Submitting...":"Create Campaign"})]})}var c=a(9099),g=a(9161),d=a(1249);function m(){let e=(0,c.useRouter)();return(0,l.jsx)(g.A,{children:(0,l.jsx)(d.A,{children:(0,l.jsx)(u,{onCreated:()=>e.push("/campaigns")})})})}},8572:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/campaigns/new",function(){return a(7172)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[579,719,703,636,593,792],()=>t(8572)),_N_E=e.O()}]);